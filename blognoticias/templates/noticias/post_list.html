{% extends 'base_layout.html' %}
{% load static %}
{% block title %}Publicaciones{% endblock %}

{% block contenido %}
<div class="container-fluid px-3">
  <h2 class="text-warning mb-3">游닗 Publicaciones recientes</h2>
  <p class="text-light small mb-4">Total de publicaciones: {{ posts|length }}</p>

  <!-- Filtro -->
  <form method="get" class="row g-2 mb-4">
    <div class="col-md-5">
      <select name="categoria" class="form-select bg-dark text-light border-light">
        <option value="">Todas las categor칤as</option>
        {% for cat in categorias %}
          <option value="{{ cat.pk }}" {% if request.GET.categoria == cat.pk|stringformat:"s" %}selected{% endif %}>
            {{ cat.titulo }}
          </option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-5">
      <select name="orden" class="form-select bg-dark text-light border-light">
        <option value="reciente" {% if request.GET.orden == "reciente" %}selected{% endif %}>M치s recientes</option>
        <option value="antiguo" {% if request.GET.orden == "antiguo" %}selected{% endif %}>M치s antiguos</option>
      </select>
    </div>
    <div class="col-md-2 d-flex align-items-end">
      <button type="submit" class="btn btn-outline-warning w-100">Filtrar</button>
    </div>
  </form>

  <p class="text-light small">Total categor칤as: {{ categorias|length }}</p>

  {% if request.user.is_authenticated %}
    <div class="mb-4 text-end">
      <a href="{% url 'noticias:create' %}"class="btn btn-success btn-sm text-dark">
        <i class="bi bi-plus-circle"></i> Crear nueva publicaci칩n
      </a>
    </div>
  {% endif %}

  <!-- Publicaciones -->
  <div class="row">
    {% for post in posts %}
      {% include 'noticias/post_target.html' with post=post %}
    {% empty %}
      <div class="alert alert-warning col-12 text-center">No hay publicaciones disponibles.</div>
    {% endfor %}
  </div>

  <!-- Paginaci칩n -->
  {% if pagination %}
    <nav aria-label="Page navigation" class="mt-4">
      <ul class="pagination justify-content-center">
        {% if pagination.first_page %}
          <li class="page-item"><a class="page-link" href="{{ pagination.first_page }}">Primera</a></li>
        {% endif %}
        {% if pagination.previous_page %}
          <li class="page-item"><a class="page-link" href="{{ pagination.previous_page }}">Anterior</a></li>
        {% endif %}
        {% if pagination.next_page %}
          <li class="page-item"><a class="page-link" href="{{ pagination.next_page }}">Siguiente</a></li>
        {% endif %}
        {% if pagination.last_page %}
          <li class="page-item"><a class="page-link" href="{{ pagination.last_page }}">칔ltima</a></li>
        {% endif %}
      </ul>
    </nav>
  {% endif %}
</div>
{% endblock %}
