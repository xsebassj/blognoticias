{% extends 'base_layout.html' %}
{% load static %}
{% block title %}Publicaciones{% endblock %}

{% block contenido %}
<div class="container-fluid px-3">
  <h2 class="text-warning mb-3">ðŸ“° Publicaciones recientes</h2>
  <p class="text-light small mb-4">Total de publicaciones: {{ posts|length }}</p>

  <form method="get" class="row g-2 mb-4">
    <div class="col-md-5">
      <select name="categoria" class="form-select bg-dark text-light border-light">
        <option value="">Todas las categorÃ­as</option>
        {% for cat in categorias %}
          <option value="{{ cat.pk }}" {% if request.GET.categoria == cat.pk|stringformat:"s" %}selected{% endif %}>
            {{ cat.titulo }}
          </option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-5">
      <select name="orden" class="form-select bg-dark text-light border-light">
        <option value="reciente" {% if request.GET.orden == "reciente" %}selected{% endif %}>MÃ¡s recientes</option>
        <option value="antiguo" {% if request.GET.orden == "antiguo" %}selected{% endif %}>MÃ¡s antiguos</option>
        <option value="az" {% if request.GET.orden == "az" %}selected{% endif %}>Orden alfabÃ©tico Aâ†’Z</option>
        <option value="za" {% if request.GET.orden == "za" %}selected{% endif %}>Orden alfabÃ©tico Zâ†’A</option>
     </select>
    </div>
    <div class="col-md-2 d-flex align-items-end">
      <button type="submit" class="btn btn-outline-warning w-100">Filtrar</button>
    </div>
  </form>

  <p class="text-light small">Total categorÃ­as: {{ categorias|length }}</p>

  {% if request.user.is_authenticated %}
    <div class="mb-4 text-end">
      <a href="{% url 'noticias:create' %}"class="btn btn-success btn-sm text-dark">
        <i class="bi bi-plus-circle"></i> Crear nueva publicaciÃ³n
      </a>
    </div>
  {% endif %}

  <div class="row">
    {% for post in posts %}
      {% include 'noticias/post_target.html' with post=post %}
    {% empty %}
      <div class="alert alert-warning col-12 text-center">No hay publicaciones disponibles.</div>
    {% endfor %}
  </div>
    {% if is_paginated %}
  <nav aria-label="Page navigation" class="mt-4">
    <ul class="pagination justify-content-center">

      {% if page_obj.has_previous %}
        <li class="page-item">
          <a class="page-link custom-page" href="?page=1">&laquo; Primera</a>
        </li>
        <li class="page-item">
          <a class="page-link custom-page" href="?page={{ page_obj.previous_page_number }}">Anterior</a>
        </li>
      {% endif %}

      {% for num in paginator.page_range %}
        {% if num == page_obj.number %}
          <li class="page-item active">
            <a class="page-link custom-page active">{{ num }}</a>
          </li>
        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
          <li class="page-item">
            <a class="page-link custom-page" href="?page={{ num }}">{{ num }}</a>
          </li>
        {% endif %}
      {% endfor %}

      {% if page_obj.has_next %}
        <li class="page-item">
          <a class="page-link custom-page" href="?page={{ page_obj.next_page_number }}">Siguiente</a>
        </li>
        <li class="page-item">
          <a class="page-link custom-page" href="?page={{ paginator.num_pages }}">Ãšltima &raquo;</a>
        </li>
      {% endif %}

         </ul>
     </nav>
    {% endif %}
      <style>
    .custom-page {
     background-color: black;
        color: yellow ;
        border: 1px solid yellow;
    }
    .custom-page:hover {
    background-color: yellow;
    color: black ;
    }
    .page-item.active .custom-page {
    background-color: yellow ;
    color: black;
    border-color: black;
    }
    </style>

    </ul>
  </nav>
</div>
{% endblock %}
