{% extends 'base_layout.html' %}
{% block title %}Crear publicación{% endblock %}

{% block contenido %}
<h2 class="text-warning mb-4"><i class="bi bi-pencil-square"></i> Nueva publicación</h2>

{% if messages %}
  <div class="container mt-3">
    {% for message in messages %}
      <div class="alert alert-success alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  </div>
{% endif %}

<form method="post" enctype="multipart/form-data" class="bg-dark text-light p-4 rounded-3 shadow">
  {% csrf_token %}

  <div class="mb-3">
    <label class="form-label d-block text-warning">Categoría</label>
    <div class="d-flex flex-wrap gap-2">
      {% for cat in category %}
        <input type="radio" class="btn-check" name="categoria" id="cat{{ cat.id }}" value="{{ cat.id }}">
        <label class="btn btn-outline-warning" for="cat{{ cat.id }}">{{ cat.titulo }}</label>
      {% endfor %}
    </div>
  </div>

  {{ form.as_p }}

  <div class="mb-3">
    <label for="images" class="form-label text-warning">Imágenes</label>
    <input type="file" name="images" id="images" multiple accept="image/*" class="form-control">
  </div>

  <div id="preview" class="d-flex flex-wrap gap-2 mb-3"></div>

  <button type="submit" class="btn btn-success w-100">
    <i class="bi bi-upload"></i> Publicar
  </button>
</form>
<style>
  /* Botón de categoría activo */
  .btn-check:checked + .btn-outline-warning,
  .btn-outline-warning.active {
    background-color: #ffc107;
    color: #121212;
    border-color: #ffc107;
  }

  /* Campos oscuros */
  input[type="text"],
  textarea,
  select,
  .form-control {
    background-color: #1e1e1e !important;
    color: #f1f1f1 !important;
    border: 1px solid #444 !important;
  }

  input::placeholder,
  textarea::placeholder {
    color: #aaa !important;
  }

  label {
    color: #ffc107;
  }
</style>
<script>
  const radios = document.querySelectorAll('input[name="categoria"]');
  radios.forEach(radio => {
    radio.addEventListener('change', () => {
      radios.forEach(r => {
        document.querySelector(`label[for="${r.id}"]`).classList.remove('active');
      });
      document.querySelector(`label[for="${radio.id}"]`).classList.add('active');
    });
  });
</script>

<script>
  const input = document.getElementById('images');
  const preview = document.getElementById('preview');

  input.addEventListener('change', () => {
    preview.innerHTML = '';
    Array.from(input.files).forEach(file => {
      if (file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = e => {
          const img = document.createElement('img');
          img.src = e.target.result;
          img.className = 'img-thumbnail border border-light';
          img.style.maxWidth = '150px';
          img.style.maxHeight = '150px';
          preview.appendChild(img);
        };
        reader.readAsDataURL(file);
      }
    });
  });
</script>
{% endblock %}
